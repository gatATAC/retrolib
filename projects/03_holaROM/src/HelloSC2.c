__sfr __at 0xA8 g_slotPort;

// MSX Hello World Sc2 ROM by aorante/303bcn

// screen 2
#define BASE10 0x1800 // base 10 name table (6144)
#define BASE11 0x2000 // base 11 color table (8192)
#define BASE12 0x0000 // base 12 character pattern table (0)
#define BASE13 0x1B00 // base 13 sprite attribute table (6912)
#define BASE14 0x3800 // base 14 sprite pattern table (14336)

 
void mainWindow();
void screen(char mode);
void color(char fg, char bg, char bd);
void vpoke(unsigned int address, unsigned char value);
unsigned char vpeek(unsigned int address);
void vpoke_block(unsigned int address, char* block, unsigned int size);
void VDP_FillVRAM (unsigned int begin, unsigned int size, unsigned char value);
void vprint(unsigned char posx, unsigned char posy, char* text, unsigned int size);
unsigned char peek(unsigned int address);
void poke(unsigned int address, unsigned char value);
unsigned char inkey();
void CHKRAM();

      
void main(void) 
{
  __asm
    di
    ld sp, (#0xFC4A)
    ei
  __endasm;
  g_slotPort = (g_slotPort & 0xCF) | ((g_slotPort & 0x0C) << 2);
  
  mainWindow();
  
  CHKRAM();
}


void mainWindow()
{  
  int size,address,i;
  unsigned char value;

// tileset: 32>90
// pattern data
unsigned char font[]={
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xF3,0xF3,0xF3,0xFF,0xF3,0xF3,0xFF,
0xFF,0xEB,0xEB,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xC9,0x80,0x80,0xC1,0xE3,0xF7,0xFF,
0xF7,0xC1,0x97,0xC1,0xF4,0xC1,0xF7,0xFF,
0xFF,0xCC,0xC9,0xF3,0xE4,0xCC,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xF9,0xF3,0xF3,0xF3,0xF3,0xF3,0xF9,0xFF,
0xCF,0xE7,0xE7,0xE7,0xE7,0xE7,0xCF,0xFF,
0xFF,0xA5,0xC3,0x81,0xC3,0xA5,0xFF,0xFF,
0xFF,0xE7,0xE7,0x81,0xE7,0xE7,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xE7,0xE7,0xEF,0xFF,
0xFF,0xFF,0xFF,0x81,0xFF,0xFF,0xFF,0xFF,
0xFF,0xFF,0xFF,0xFF,0xE7,0xE7,0xFF,0xFF,
0xFF,0xF9,0xF3,0xE7,0xCF,0x9F,0xFF,0xFF,
0xFF,0xC1,0x9C,0x9C,0x9C,0xC1,0xFF,0xFF,
0xFF,0xE7,0xC7,0xE7,0xE7,0xC3,0xFF,0xFF,
0xFF,0x81,0xFC,0xC1,0x9F,0x80,0xFF,0xFF,
0xFF,0x81,0xFC,0xE1,0xFC,0x81,0xFF,0xFF,
0xFF,0x9C,0x9C,0x80,0xFC,0xFC,0xFF,0xFF,
0xFF,0x80,0x9F,0x81,0xFC,0x81,0xFF,0xFF,
0xFF,0xC1,0x9F,0x81,0x9C,0xC1,0xFF,0xFF,
0xFF,0x80,0xFC,0xF9,0xF3,0xF3,0xFF,0xFF,
0xFF,0xC1,0x9C,0xC1,0x9C,0xC1,0xFF,0xFF,
0xFF,0xC1,0x9C,0xC0,0xFC,0xC1,0xFF,0xFF,
0xFF,0xE7,0xE7,0xFF,0xE7,0xE7,0xFF,0xFF,
0xFF,0xE7,0xE7,0xFF,0xE7,0xE7,0xEF,0xFF,
0xFF,0xF3,0xE7,0xCF,0xE7,0xF3,0xFF,0xFF,
0xFF,0xFF,0xC3,0xFF,0xC3,0xFF,0xFF,0xFF,
0xFF,0xCF,0xE7,0xF3,0xE7,0xCF,0xFF,0xFF,
0xFF,0xE1,0xCC,0xF9,0xF3,0xFF,0xF3,0xFF,
0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
0xFF,0xC1,0x9C,0x80,0x9C,0x9C,0xFF,0xFF,
0xFF,0x81,0x9C,0x81,0x9C,0x81,0xFF,0xFF,
0xFF,0xC0,0x9F,0x9F,0x9F,0xC0,0xFF,0xFF,
0xFF,0x81,0x9C,0x9C,0x9C,0x81,0xFF,0xFF,
0xFF,0x80,0x9F,0x83,0x9F,0x80,0xFF,0xFF,
0xFF,0x80,0x9F,0x83,0x9F,0x9F,0xFF,0xFF,
0xFF,0xC0,0x9F,0x98,0x9C,0xC0,0xFF,0xFF,
0xFF,0x9C,0x9C,0x80,0x9C,0x9C,0xFF,0xFF,
0xFF,0xE1,0xF3,0xF3,0xF3,0xE1,0xFF,0xFF,
0xFF,0xE1,0xF3,0xF3,0x93,0xC7,0xFF,0xFF,
0xFF,0x9C,0x99,0x83,0x99,0x9C,0xFF,0xFF,
0xFF,0x9F,0x9F,0x9F,0x9F,0x80,0xFF,0xFF,
0xFF,0x9C,0x88,0x80,0x94,0x9C,0xFF,0xFF,
0xFF,0x9C,0x8C,0x84,0x90,0x98,0xFF,0xFF,
0xFF,0xC1,0x9C,0x9C,0x9C,0xC1,0xFF,0xFF,
0xFF,0x81,0x9C,0x9C,0x81,0x9F,0xFF,0xFF,
0xFF,0xC1,0x9C,0x94,0x99,0xC2,0xFF,0xFF,
0xFF,0x81,0x9C,0x9C,0x81,0x9C,0xFF,0xFF,
0xFF,0xC0,0x9F,0xC1,0xFC,0x81,0xFF,0xFF,
0xFF,0x81,0xE7,0xE7,0xE7,0xE7,0xFF,0xFF,
0xFF,0x9C,0x9C,0x9C,0x9C,0xC1,0xFF,0xFF,
0xFF,0x9C,0x9C,0x9C,0xC9,0xE3,0xFF,0xFF,
0xFF,0x9C,0x94,0x80,0x88,0x9C,0xFF,0xFF,
0xFF,0x9C,0xC9,0xE3,0xC9,0x9C,0xFF,0xFF,
0xFF,0x99,0x99,0xC3,0xE7,0xE7,0xFF,0xFF,
0xFF,0x81,0xF3,0xE7,0xCF,0x81,0xFF,0xFF};

  color(15,4,1);
  screen(2);
 
  // llena la pantalla con el tile 32  
  VDP_FillVRAM(6144, 768, 32);
  
  // llena del color 4F la pantalla.  
  VDP_FillVRAM(8448, 4568, 0x4F);
   
  // escribe la fuente en la VRAM
  vpoke_block(256, font, 465);
  vpoke_block(2304, font, 465);
  vpoke_block(4352, font, 465);
  
  // Imprime el texto en la pantalla 
  vprint(9, 7, "HELLO WORLD!", 13);    
  vprint(10, 11, "HOLA MUNDO!", 12);
  
  // espera la pulsacion de una tecla
  value = inkey();
  
  return;
}




// by Andrear
void screen(char mode)
{
  mode;
__asm   
  ld a,4(ix)
  call 0x005F
__endasm;
}

// by Andrear
void color(char fg, char bg, char bd)
{
  fg;
  bg;
  bd;
__asm
  ld hl,#0xf3e9 
  ld a,4(ix)
  ld (hl),a  
  inc hl
  ld a,5(ix)
  ld (hl),a  
  inc hl
  ld a,6(ix)
  ld (hl),a  
  call 0x0062
__endasm;
}

// by Andrear
void vpoke(unsigned int address, unsigned char value)
{
  address;
  value;
__asm
  ld l,4(ix)
  ld h,5(ix)
  ld a,6(ix)
  call 0x004d
__endasm;
}

// by Andrear
unsigned char vpeek(unsigned int address)
{
  address;
__asm
   ld l,4(ix)
   ld h,5(ix)
   call 0x004a
   ld h,#0x00
   ld l,a
__endasm;
}

// vpoke_block by Andrear
void vpoke_block(unsigned int address, char* block, unsigned int size)
{
  while (size-->0){ vpoke(address++,*(block++));} 
}

// VDP_FillVRAM by nerlaska
void VDP_FillVRAM (unsigned int begin, unsigned int size, unsigned char value)
{
  begin;
  size;
  value;
__asm
  ld l, 4(ix)
  ld h, 5(ix)
  ld c, 6(ix)
  ld b, 7(ix)
  ld a, 8(ix)
  call 0x0056
__endasm;
}

void vprint(unsigned char posx, unsigned char posy, char* text, unsigned int size)
{
  int address = 6144 + (posy * 32) + posx;
  while (size-->0){ vpoke(address++,*(text++));}
}

unsigned char inkey()
{
__asm   
  call 0x009F
  ld h,#0x00
  ld l,a
__endasm;
}

unsigned char peek(unsigned int address)
{
  address;
__asm
  ld l,4(ix)
  ld h,5(ix)
  ld a,(hl)
  ld h,#0x00
  ld l,a
__endasm;
}

// by Andrear
void poke(unsigned int address, unsigned char value)
{
  address;
  value;
__asm
  ld l,4(ix)
  ld h,5(ix)
  ld a,6(ix)
  ld (hl),a
__endasm;
}

void CHKRAM()
{
__asm   
   call 0x0000
__endasm;
}
